import type { EvaluationResult, ReferenceCompany } from '../types'
import MatrixChart from './MatrixChart'

const ZONE_LABELS: Record<string, { label: string; color: string; bg: string; bar: string }> = {
  dead: { label: 'Dead Zone', color: 'text-[#d63939]', bg: 'bg-[#fae8e8]', bar: 'bg-[#d63939]' },
  compression: { label: 'Compression Zone', color: 'text-[#d49b1a]', bg: 'bg-[#faf3e0]', bar: 'bg-[#d49b1a]' },
  adaptation: { label: 'Adaptation Zone', color: 'text-[#2b7fd4]', bg: 'bg-[#e8f0fa]', bar: 'bg-[#2b7fd4]' },
  fortress: { label: 'Fortress Zone', color: 'text-[#1a9d3f]', bg: 'bg-[#e8f5ec]', bar: 'bg-[#1a9d3f]' },
}

interface Props {
  evaluation: EvaluationResult
  referenceCompanies: ReferenceCompany[]
}

export default function VulnerabilityCard({ evaluation, referenceCompanies }: Props) {
  const zone = ZONE_LABELS[evaluation.zone] || ZONE_LABELS.dead

  return (
    <div className="bg-surface-secondary rounded-xl border border-arena-border p-6">
      <h3 className="text-[15px] font-semibold text-arena-text mb-3">
        SaaS Vulnerability Assessment
      </h3>

      {/* Zone badge */}
      <div className={`inline-flex items-center gap-2 px-4 py-2 rounded-lg ${zone.bg} mb-5`}>
        <span className={`text-[14px] font-bold ${zone.color}`}>{zone.label}</span>
      </div>

      {/* Scores */}
      <div className="grid grid-cols-2 gap-4 mb-5">
        <div className="bg-surface-tertiary/60 rounded-lg p-4">
          <div className="text-[11px] text-arena-muted mb-1 font-medium uppercase tracking-wide">
            Workflow Complexity
          </div>
          <div className="text-[20px] font-bold text-arena-text">
            {evaluation.x_score}<span className="text-[13px] text-arena-muted font-normal">/100</span>
          </div>
          <div className="w-full bg-arena-border-medium rounded-full h-1.5 mt-2">
            <div
              className="bg-[#2b7fd4] h-1.5 rounded-full transition-all duration-500"
              style={{ width: `${evaluation.x_score}%` }}
            />
          </div>
        </div>
        <div className="bg-surface-tertiary/60 rounded-lg p-4">
          <div className="text-[11px] text-arena-muted mb-1 font-medium uppercase tracking-wide">
            Data Moat Depth
          </div>
          <div className="text-[20px] font-bold text-arena-text">
            {evaluation.y_score}<span className="text-[13px] text-arena-muted font-normal">/100</span>
          </div>
          <div className="w-full bg-arena-border-medium rounded-full h-1.5 mt-2">
            <div
              className="bg-[#1a9d3f] h-1.5 rounded-full transition-all duration-500"
              style={{ width: `${evaluation.y_score}%` }}
            />
          </div>
        </div>
      </div>

      {/* Justification */}
      <div className="mb-6">
        <h4 className="text-[13px] font-medium text-arena-text-secondary mb-2">Justification</h4>
        <p className="text-[13px] text-arena-muted leading-relaxed">{evaluation.justification}</p>
      </div>

      {/* Matrix */}
      <MatrixChart referenceCompanies={referenceCompanies} evaluation={evaluation} />
    </div>
  )
}
